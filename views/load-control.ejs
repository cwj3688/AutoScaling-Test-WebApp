<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CPU Load Control</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        h1, h2 { color: #333; }
        .container { max-width: 800px; margin: auto; }
        .hostname { background-color: #eee; padding: 5px; border-radius: 4px; font-weight: bold; }
        .db-status { padding: 10px; border-radius: 4px; margin-bottom: 1em; }
        .db-connected { background-color: #e0f2e9; color: #146c43; }
        .db-disconnected { background-color: #f8d7da; color: #842029; }
        .actions form { display: inline-block; margin-right: 10px; }
        button { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
        .start-btn { background-color: #0d6efd; color: white; }
        .stop-btn { background-color: #dc3545; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 1em; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .status-running { color: #dc3545; font-weight: bold; }
        .status-stopped { color: #198754; }
    </style>
</head>
<body>
    <div class="container">
        <h1>CPU 부하 제어</h1>
        <p>현재 접속된 서버: <span class="hostname"><%= hostname %></span></p>

        <% if (dbConnected) { %>
            <div class="db-status db-connected">
                <strong>DB 상태: [연결됨]</strong> 서버별 부하 상태를 확인할 수 있습니다.
            </div>
        <% } else { %>
            <div class="db-status db-disconnected">
                <strong>DB 상태: [연결 안 됨]</strong> 데이터베이스에 연결되지 않아 전체 서버 상태를 표시할 수 없습니다. 부하 제어는 현재 접속된 서버에만 적용됩니다.
            </div>
        <% } %>

        <div class="actions">
            <form action="/load" method="POST">
                <button type="submit" class="start-btn">CPU 부하 시작</button>
            </form>
            <form action="/stop" method="POST">
                <button type="submit" class="stop-btn">CPU 부하 중지</button>
            </form>
        </div>

        <h2>서버별 부하 상태</h2>
        <% if (dbConnected && loadStatus.length > 0) { %>
            <table>
                <thead>
                    <tr>
                        <th>서버 호스트네임</th>
                        <th>상태</th>
                        <th>마지막 업데이트</th>
                    </tr>
                </thead>
                <tbody>
                    <% loadStatus.forEach(item => { %>
                        <tr>
                            <td><%= item.hostname %></td>
                            <td>
                                <span class="status-<%= item.status.toLowerCase() %>">
                                    <%= item.status %>
                                </span>
                            </td>
                            <td><%= new Date(item.updated_at).toLocaleString() %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } else if (dbConnected) { %>
            <p>아직 기록된 부하 상태 정보가 없습니다.</p>
        <% } else { %>
            <p>DB가 연결되지 않아 상태를 불러올 수 없습니다.</p>
        <% } %>
         <p><a href="/">메인 페이지로 돌아가기</a></p>
    </div>
</body>
</html>